const { MongoClient } = require("mongodb");
const host = process.env.EXPLOIT_EXPORT_MONGO_HOST || "mongo";
const port = process.env.EXPLOIT_EXPORT_MONGO_PORT || "27017";
const database_name = process.env.EXPLOIT_EXPORT_MONGO_DATABASE || "finding-database";
const collectionName = process.env.EXPLOITS_COLLECTION || "findings-exploits";
var mongoDbUrl = "mongodb://" + host + ":" + port + "/" + database_name;

const client = new MongoClient(mongoDbUrl, { useNewUrlParser: true, useUnifiedTopology: true });


client.connect().then(async function() {
  const db = client.db(database_name);
  const col = db.collection(collectionName);
  let result = await col.updateMany(
    { },
    [
      { $set: { "exploits.status": "generated" } },
      { $unset: [ "exploits.success", "exploits.cookie_status", "exploits.cookie_success" ] }
    ]
  );
  console.log(`Modified ${result.modifiedCount} documents`);
  await client.close();
});


